#!/usr/bin/env bash

set-x

# Get pane index of top pane
TOP_PANE_INDEX=$(tmux display -p -t '{up-of}' '#{pane_index}')

# Capture the content of the original pane
TOP_PANE_CONTENT=$(tmux capture-pane -p -t $TOP_PANE_INDEX)

# Extract file name and line numbe 
STATUS_LINE=$(echo "$TOP_PANE_CONTENT" | rg -e "(?:NOR|INS|SEL)\s+(\S*)\s[^│]* (\d+):*.*" -o --replace '$1 $2')
FILE_NAME=$(echo $STATUS_LINE| choose 0)
LINE_NUMBER=$(echo $STATUS_LINE| choose 1)

# Run git blame and fzf commands
git blame -L $LINE_NUMBER,+100 $FILE_NAME --color-by-age --color-lines | 
  fzf --ansi \
      --border none \
      --delimiter ':' \
      --height '100%' \
      --multi \
      --print-query --exit-0 \
      --scrollbar '▍'

