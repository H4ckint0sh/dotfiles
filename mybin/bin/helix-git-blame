#!/usr/bin/env bash

# Get pane index of top pane
top_pane_index=$(tmux display -p -t '{up-of}' '#{pane_index}')

# Capture the content of the original pane
top_pane_content=$(tmux capture-pane -p -t $top_pane_index)

# Extract file name and line numbe 
status_line=$(echo "$top_pane_content" | rg -e "(?:NOR|INS|SEL)\s+(\S*)\s[^│]* (\d+):*.*" -o --replace '$1 $2')
file_name=$(echo $status_line| choose 0)
line_number=$(echo $status_line| choose 1)

# Run git blame and fzf commands
git blame -L $line_number,+100 $file_name --color-by-age --color-lines | 
  fzf --ansi \
      --border \
      --delimiter ':' \
      --height '100%' \
      --multi \
      --print-query --exit-0 \
      --scrollbar '▍'

